rest_calls:
  - path: /mgmt/shared/authn/login
    method: POST
    headers:
      Content-type: application/json
    payload:
      username: '{{ username }}'
      password: '{{ password }}'
    response_format: json
    recoverable_codes: [400, 401, 404, 502, 503]
    response_translation:
      token:
        token: [token]
    response_expectation:
      - ['username', '{{ username }}']
    host: '{{host}}'

  - path: /mgmt/shared/appsvcs/declare
    method: POST
    host: '{{host}}'
    headers:
      X-F5-Auth-Token: "{{token}}"
      Content-type: application/json
    response_format: json
    recoverable_codes: [400, 401, 404, 422, 502, 503]
    payload:
      class: AS3
      action: deploy
      persist: true
      declaration:
        class: ADC
        schemaVersion: 3.0.0
        label: Sample 1
        remark: Simple HTTP application with RR pool
        demo:
          class: Tenant
          Simple_HTTP:
            class: Application
            template: http
            serviceMain:
              class: Service_HTTP
              virtualAddresses:
                - '{{vs_virtualAddress}}'
              virtualPort: {{vs_virtualPort}}
              snat: auto
              pool: web_pool
            web_pool:
              class: Pool
              monitors:
                - icmp
              members:
                - servicePort: {{webserver_port}}
                  serverAddresses:
                    - '{{pool_member}}'

